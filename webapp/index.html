<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>–ü—Ä–æ—Ñ–¢—Ä–µ–π–¥–õ–∞–± ‚Äî 8‚Äëbit Runner</title>
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="46" fill="%2317F1E9"/><text x="50" y="70" text-anchor="middle" font-size="70" fill="black">üß™</text></svg>'>
  <style>
    :root{
      --brand:#17F1E9; --brand-2:#00C1C4;
      --bg:#000; --card:#0b0b0b; --ok:#0f0; --bad:#f33; --text:#d9fff9; --muted:#9beee7;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; font-family:monospace; background:var(--bg); color:var(--text); }
    body{ display:grid; place-items:center; }
    .wrap{ width:100%; max-width: 980px; padding: 12px; }
    .card{
      background:var(--card); border:3px solid var(--brand); border-radius:8px; image-rendering:pixelated;
      box-shadow:0 0 18px rgba(23,241,233,.45);
    }
    h1{ font-size:20px; margin:0; padding:10px 12px; display:flex; align-items:center; gap:10px;
        background:linear-gradient(45deg, rgba(23,241,233,.08), rgba(0,193,196,.08));
        border-bottom:1px solid rgba(23,241,233,.35);}
    .bar{ display:flex; justify-content:space-between; align-items:flex-start; gap:8px; padding:8px 12px; flex-wrap:wrap; }
    .hint{ font-size:12px; color:var(--muted); }
    .btn{ background:#101010; color:var(--text); border:2px solid var(--brand); padding:8px 12px; cursor:pointer; border-radius:8px; }
    .btn:active{ background:var(--brand); color:#001314; }
    .btn.brand{ background: linear-gradient(0.125turn, var(--brand) 0%, var(--brand-2) 100%); color:#001314; border-color:transparent; }
    canvas{ display:block; width:100%; height:auto; background:#111; image-rendering:pixelated; border-radius:0 0 8px 8px; }

    /* –û–≤–µ—Ä–ª–µ–∏ */
    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.9); display:none; align-items:center; justify-content:center; padding:16px; z-index:50; }
    .panel{ background:#0e0e0e; border:3px solid var(--brand); border-radius:10px; box-shadow:0 0 18px rgba(23,241,233,.45); width:100%; max-width:860px; }
    .panel .inner{ display:grid; gap:14px; padding:16px; grid-template-columns: 1fr 320px; }
    @media (max-width: 740px){
      .panel .inner{ grid-template-columns: 1fr; }
    }
    input[type="text"],input[type="tel"],input[type="email"]{
      width:100%; background:#000; border:2px solid var(--brand); color:#cffff8; padding:8px; border-radius:6px; margin-top:4px;
    }
    .field{ margin:6px 0; }
    .checkbox{ display:flex; gap:8px; align-items:flex-start; font-size:12px; color:#bffff6; }

    /* –¢–∞–±–ª–∏—á–∫–∞ –ø—Ä–∏–∑–æ–≤ —Å–ø—Ä–∞–≤–∞ */
    .prizes{
      border:2px solid var(--brand); border-radius:8px; padding:10px; background:#0a0a0a;
    }
    .prizes h3{ margin:0 0 8px; font-size:16px; }
    .prize-row{ display:flex; justify-content:space-between; gap:8px; padding:6px 0; border-bottom:1px dashed rgba(23,241,233,.45); }
    .prize-row:last-child{ border-bottom:none; }
    .p-points{ color:#17F1E9; }
    .p-name{ color:#bffff6; }

    .countdownText{ position:absolute; left:50%; top:45%; transform:translate(-50%,-50%); font-size:56px; color:var(--brand); text-shadow:0 0 16px rgba(23,241,233,.7); }

    /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
    .panel .center{ padding:16px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üß™ –ü—Ä–æ—Ñ–¢—Ä–µ–π–¥–õ–∞–± 8‚Äëbit Runner</h1>
      <canvas id="game" width="900" height="300"></canvas>
      <div class="bar">
        <div>
          –û—á–∫–∏: <span id="score">0</span> ¬∑ –†–µ–∫–æ—Ä–¥: <span id="best">0</span> ¬∑ –û—Å—Ç–∞–ª–æ—Å—å: <span id="timeLeft">02:00</span>
          <div class="hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∂–º–∏—Ç–µ –∑–∞—Ä–∞–Ω–µ–µ ‚Äî –ø—Ä—ã–∂–æ–∫ –¥–ª–∏–Ω–Ω–µ–µ. –ü—Ä–æ–∏–≥—Ä–∞–ª–∏? –ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–Ω–æ–≤–æ¬ª.</div>
        </div>
        <div style="display:flex; gap:8px;">
          <button id="restart" class="btn">–ó–∞–Ω–æ–≤–æ</button>
          <button id="newSession" class="btn brand">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
      </div>
    </div>
  </div>

  <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
  <div id="regOverlay" class="overlay" style="display:flex">
    <div class="panel">
      <div class="inner">
        <div>
          <h2 style="margin:4px 0 10px">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
          <div class="field">
            <label>–§–ò–û</label>
            <input id="fio" type="text" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
          </div>
          <div class="field">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input id="phone" type="tel" placeholder="+7 900 000-00-00">
          </div>
          <div class="field">
            <label>Email</label>
            <input id="email" type="email" placeholder="name@example.com">
          </div>
          <label class="checkbox"><input id="consent" type="checkbox"> –°–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
          <div class="hint">–î–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è –≤—ã–¥–∞—á–∏ –ø—Ä–∏–∑–∞ –∏ —Å–≤—è–∑–∏ —Å –≤–∞–º–∏.</div>
          <div style="margin-top:12px; text-align:right;">
            <button id="startBtn" class="btn brand">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
          </div>
          <div id="regErr" style="color:#ff8a8a; margin-top:6px;"></div>
        </div>

        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –ø—Ä–∏–∑–∞–º–∏ -->
        <div class="prizes">
          <h3>–ü—Ä–∏–∑—ã –∏ –æ—á–∫–∏</h3>
          <div class="prize-row"><div class="p-points">20‚Äì30</div><div class="p-name">–ë—Ä–µ–ª–æ–∫</div></div>
          <div class="prize-row"><div class="p-points">30‚Äì50</div><div class="p-name">–ë–ª–æ–∫–Ω–æ—Ç –∏ —Ä—É—á–∫–∞</div></div>
          <div class="prize-row"><div class="p-points">50‚Äì70</div><div class="p-name">–®–æ–ø–ø–µ—Ä</div></div>
          <div class="prize-row"><div class="p-points">70+</div><div class="p-name">–¢–µ—Ä–º–æ—Å</div></div>
          <div style="margin-top:8px" class="hint">–û—á–∫–∏ ‚Äî –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 2 –º–∏–Ω—É—Ç—ã.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
  <div id="resultOverlay" class="overlay">
    <div class="panel">
      <div class="center">
        <h2 style="margin:4px 0 10px">–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h2>
        <p>–í–∞—à –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <b id="finalBest">0</b> –æ—á–∫–æ–≤.</p>
        <p>–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: <b id="prizeText">‚Äî</b></p>
        <p style="margin-top:8px">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–∑–∞.</p>
        <div style="margin-top:12px;text-align:right;">
          <button id="resultOk" class="btn brand">–ù–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  // ====== –ê–î–ê–ü–¢–ò–í–ù–´–ô CANVAS ======
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  let W = canvas.width, H = canvas.height;
  function resizeCanvas() {
    // —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 3:1, –º–∞–∫—Å–∏–º—É–º 980px —à–∏—Ä–∏–Ω–∞
    const container = canvas.parentElement;
    const cssW = Math.min(container.clientWidth, 980);
    const cssH = Math.max(220, Math.round(cssW / 3));
    // —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä –∫–∞–Ω–≤–∞—Å–∞ –ø–æ–¥ DPR –¥–ª—è —á—ë—Ç–∫–æ—Å—Ç–∏
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    canvas.style.width = cssW + 'px';
    canvas.style.height = cssH + 'px';
    canvas.width = Math.round(cssW * dpr);
    canvas.height = Math.round(cssH * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // –ª–æ–≥–∏—á–µ—Å–∫–∏–µ px = CSS px
    W = cssW; H = cssH;
    GROUND_Y = H - 32;
  }
  window.addEventListener('resize', resizeCanvas);

  // ====== –ü–ê–†–ê–ú–ï–¢–†–´ –ò–ì–†–´ (–º—è–≥—á–µ, —Ä–µ–∂–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, 8-bit) ======
  let GROUND_Y = H - 32;
  const GRAVITY = 0.65;
  const JUMP_VELOCITY = -12.2;
  const SPEED_START = 5;
  const SPEED_INC = 0.00035;

  // —Å–ø–∞–≤–Ω —Ä–µ–∂–µ: 180‚Äì360 ¬´–µ–¥–∏–Ω–∏—Ü —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è¬ª (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç worldSpeed)
  const SPAWN_MIN = 180, SPAWN_VAR = 180;

  let worldSpeed = SPEED_START, score = 0, best = 0, gameOver = false, ready = false;

  const player = { x: 50, y: GROUND_Y - 20, w: 20, h: 20, vy: 0, onGround: true };
  const obstacles = []; let spawnTimer = 0;

  function resetRun(){
    worldSpeed = SPEED_START; score = 0; gameOver = false;
    player.y = GROUND_Y - player.h; player.vy = 0; player.onGround = true;
    obstacles.length = 0; spawnTimer = 0; loop();
  }

  function spawnObstacle(){
    const s = 10 + Math.floor(Math.random() * 20);
    obstacles.push({ x: W + 10, y: GROUND_Y - s, w: s, h: s, passed: false });
  }

  function jump(){
    if (gameOver || !sessionActive() || !ready) return;
    if (player.onGround) { player.vy = JUMP_VELOCITY; player.onGround = false; }
  }

  window.addEventListener('keydown', e => {
    if (e.code === 'Space' || e.code === 'ArrowUp'){ e.preventDefault(); jump(); }
    if (e.code === 'Enter' && (gameOver || !sessionActive())) startCountdown(()=>resetRun());
  });
  canvas.addEventListener('pointerdown', jump);

  let rafId=null; function loop(){ cancelAnimationFrame(rafId); rafId = requestAnimationFrame(update); }

  function update(){
    // —Ñ–æ–Ω
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,W,H);
    const grd = ctx.createLinearGradient(0,GROUND_Y,W,GROUND_Y);
    grd.addColorStop(0,"#17F1E9"); grd.addColorStop(1,"#00C1C4");
    ctx.fillStyle = grd; ctx.fillRect(0,GROUND_Y,W,2);

    if(!sessionActive()){ dimOverlay('–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞'); return; }

    spawnTimer -= worldSpeed;
    if (spawnTimer <= 0) { spawnObstacle(); spawnTimer = SPAWN_MIN + Math.random()*SPAWN_VAR; }

    // –∏–≥—Ä–æ–∫
    player.vy += GRAVITY; player.y += player.vy;
    if (player.y >= GROUND_Y - player.h){ player.y = GROUND_Y - player.h; player.vy = 0; player.onGround = true; }

    // –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è (AABB —Å ¬´–ø—Ä–æ—â–µ–Ω–∏–µ–º¬ª 2px)
    ctx.fillStyle = '#17F1E9';
    for (let i=obstacles.length-1;i>=0;i--){
      const o = obstacles[i]; o.x -= worldSpeed;
      ctx.fillRect(o.x, o.y, o.w, o.h);
      if (o.x + o.w < 0) obstacles.splice(i,1);
      if (!o.passed && o.x + o.w < player.x){ o.passed = true; score++; updateHud(); }
      if (!gameOver && collideForgiven(player,o,2)){
        gameOver = true; if (score > best){ best = score; updateHud(); }
      }
    }

    ctx.fillStyle = gameOver ? '#f33' : '#0f0';
    ctx.fillRect(player.x, player.y, player.w, player.h);

    if (!ready){ drawCountdown(); return; }
    if (gameOver) return;

    worldSpeed += SPEED_INC;
    loop();
  }

  function collideForgiven(a,b,f){
    const bx=b.x+f, by=b.y+f, bw=b.w-2*f, bh=b.h-2*f;
    return a.x < bx + bw && a.x + a.w > bx && a.y < by + bh && a.y + a.h > by;
  }

  // ====== HUD / –∫–Ω–æ–ø–∫–∏ ======
  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');
  const timeEl  = document.getElementById('timeLeft');

  document.getElementById('restart').onclick = () => {
    if (!sessionActive()) return;
    startCountdown(()=>resetRun());
  };
  document.getElementById('newSession').onclick = openReg;

  function updateHud(){ scoreEl.textContent = String(score); bestEl.textContent = String(best); }

  // ====== –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / 2‚Äë–º–∏–Ω—É—Ç–Ω–∞—è —Å–µ—Å—Å–∏—è ======
  const regOverlay = document.getElementById('regOverlay');
  const resultOverlay = document.getElementById('resultOverlay');
  const startBtn = document.getElementById('startBtn');
  const resultOk = document.getElementById('resultOk');
  const regErr = document.getElementById('regErr');
  const fioIn = document.getElementById('fio');
  const phoneIn = document.getElementById('phone');
  const emailIn = document.getElementById('email');
  const consentIn = document.getElementById('consent');
  const finalBest = document.getElementById('finalBest');
  const prizeText = document.getElementById('prizeText');

  let profile = null, sessionEndAt = null, timerId = null;

  function openReg(){ regErr.textContent=''; regOverlay.style.display='flex'; }
  function closeReg(){ regOverlay.style.display='none'; }

  startBtn.onclick = () => {
    const fio = fioIn.value.trim(), phone = phoneIn.value.trim(), email = emailIn.value.trim();
    if (!fio) { regErr.textContent = '–£–∫–∞–∂–∏—Ç–µ –§–ò–û'; return; }
    if (!consentIn.checked) { regErr.textContent = '–ù—É–∂–Ω–æ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö'; return; }
    profile = { fio, phone, email };
    best = 0; score = 0; updateHud();
    sessionEndAt = Date.now() + 2*60*1000; // 2 –º–∏–Ω—É—Ç—ã
    closeReg();
    startCountdown(()=>resetRun());
    tickTimer();
  };

  resultOk.onclick = () => { resultOverlay.style.display='none'; openReg(); };

  function tickTimer(){
    clearInterval(timerId);
    timerId = setInterval(()=>{
      const left = Math.max(0, (sessionEndAt || 0) - Date.now());
      timeEl.textContent = fmt(left);
      if (left <= 0){ clearInterval(timerId); showResults(); }
    }, 200);
  }

  function fmt(ms){
    const s = Math.ceil(ms/1000), m = Math.floor(s/60), ss = String(s%60).padStart(2,'0');
    return `${String(m).padStart(2,'0')}:${ss}`;
  }
  function sessionActive(){ return sessionEndAt && Date.now() < sessionEndAt; }

  function showResults(){
    finalBest.textContent = String(best);
    prizeText.textContent = getPrize(best);
    // –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Telegram –±–æ—Ç–∞:
    try{
      if (window.Telegram?.WebApp){
        window.Telegram.WebApp.sendData(JSON.stringify({ type:'session_result', profile, best }));
      }
    }catch(e){}
    resultOverlay.style.display='flex';
  }

  // –ù–æ–≤—ã–µ –ø–æ—Ä–æ–≥–∏ –ø—Ä–∏–∑–æ–≤:
  function getPrize(p){
    if (p >= 70) return '–¢–µ—Ä–º–æ—Å';
    if (p >= 50) return '–®–æ–ø–ø–µ—Ä';
    if (p >= 30) return '–ë–ª–æ–∫–Ω–æ—Ç –∏ —Ä—É—á–∫–∞';
    if (p >= 20) return '–ë—Ä–µ–ª–æ–∫';
    return '‚Äî';
  }

  // ====== UX: 3‚Äë2‚Äë1 –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º/—Ä–µ—Å—Ç–∞—Ä—Ç–æ–º ======
  function startCountdown(cb){
    ready = false;
    let t = 3;
    const step = ()=>{
      drawCountdown(t);
      if (t === 0){ ready = true; cb && cb(); }
      else setTimeout(()=>{ t--; step(); }, 500);
    };
    step();
  }
  function drawCountdown(n){
    // –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ
    ctx.fillStyle = 'rgba(0,0,0,.35)'; ctx.fillRect(0,0,W,H);
    ctx.font = 'bold 56px monospace'; ctx.textAlign='center'; ctx.fillStyle = '#17F1E9';
    ctx.fillText(n ?? ' ', W/2, H/2);
  }
  function dimOverlay(msg){
    ctx.fillStyle='rgba(0,0,0,.6)'; ctx.fillRect(0,0,W,H);
    ctx.font='16px monospace'; ctx.textAlign='center'; ctx.fillStyle='#d9fff9';
    ctx.fillText(msg, W/2, H/2);
  }

  // —Å—Ç–∞—Ä—Ç: –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —ç–∫—Ä–∞–Ω + —Ñ–æ—Ä–º–∞
  resizeCanvas();
  openReg();
  updateHud();
  // —Å—Ç–∞—Ç–∏—á–Ω–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ –¥–æ —Å—Ç–∞—Ä—Ç–∞
  (function first(){
    ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H);
    const g=ctx.createLinearGradient(0,GROUND_Y,W,GROUND_Y); g.addColorStop(0,'#17F1E9'); g.addColorStop(1,'#00C1C4');
    ctx.fillStyle=g; ctx.fillRect(0,GROUND_Y,W,2);
  })();
})();
</script>
</body>
</html>
