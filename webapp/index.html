<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>–ü—Ä–æ—Ñ–¢—Ä–µ–π–¥–õ–∞–± ‚Äî 8-bit Runner</title>
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="46" fill="%2353B5AF"/><text x="50" y="70" text-anchor="middle" font-size="70" fill="black">üß™</text></svg>'>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--brand:#53B5AF;--bg:#000;--card:#000;--text:#fff;--muted:#cfe9e7;--pad:12px;--app-height:100vh}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:monospace;background:var(--bg);color:var(--text)}
    #app-root{position:relative;width:100%;min-height:var(--app-height);display:flex}
    .wrap{flex:1;display:flex}
    .card{flex:1;display:flex;flex-direction:column;background:var(--card);border:3px solid var(--brand);image-rendering:pixelated;box-shadow:0 0 18px rgba(83,181,175,.35)}
    h1{font-size:20px;margin:0;padding:10px var(--pad);display:flex;align-items:center;gap:10px;background:linear-gradient(45deg, rgba(83,181,175,.10), rgba(83,181,175,.10));border-bottom:1px solid rgba(83,181,175,.35);color:var(--text)}
    .gameBox{flex:1;display:flex;flex-direction:column;min-height:0}
    canvas{display:block;width:100%;height:auto;background:#000;image-rendering:pixelated;touch-action:manipulation;-webkit-user-select:none;user-select:none}
    .bar{display:flex;justify-content:space-between;align-items:flex-start;gap:8px;padding:8px var(--pad);flex-wrap:wrap}
    .hint{font-size:12px;color:var(--muted)}
    .btn{background:#000;color:var(--text);border:2px solid var(--brand);padding:8px 12px;cursor:pointer;border-radius:8px}
    .btn.brand{background:var(--brand);color:#000;border-color:transparent}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.92);display:none;align-items:center;justify-content:center;padding:16px;z-index:999;height:var(--app-height)}
    .panel{background:#000;border:3px solid var(--brand);border-radius:10px;box-shadow:0 0 18px rgba(83,181,175,.35);width:100%;max-width:860px;max-height:calc(var(--app-height) - 32px);display:flex;flex-direction:column}
    .panel .inner{display:grid;gap:14px;padding:16px;grid-template-columns:1fr 320px;overflow:auto}
    @media (max-width:740px){.panel .inner{grid-template-columns:1fr}}
    #regOverlay .panel,#resultOverlay .panel{background:#fff;border:2px solid #e5e5e5;box-shadow:0 6px 28px rgba(0,0,0,.18)}
    #regOverlay h2,#resultOverlay h2,#regOverlay label,#resultOverlay p,#regOverlay .note,#resultOverlay{color:#000}
    #regOverlay input[type="text"],#regOverlay input[type="tel"],#regOverlay input[type="email"]{width:100%;background:#fff;border:2px solid #e5e5e5;color:#000;padding:8px;border-radius:6px;margin-top:4px}
    #regOverlay .checkbox{color:#000}
    .qrbox{background:#fff;border:2px solid #e5e5e5;border-radius:10px;padding:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px}
    .qrbox img{max-width:260px;width:100%;height:auto;display:block;border-radius:8px;border:1px solid #e5e5e5}
    .qrbox small{color:#333;text-align:center;line-height:1.3}
    .error{color:#d50000;margin-top:6px}
  </style>
</head>
<body>
  <div id="app-root">
    <div class="wrap">
      <div class="card">
        <h1>üß™ –ü—Ä–æ—Ñ–¢—Ä–µ–π–¥–õ–∞–± 8-bit Runner</h1>
        <div class="gameBox">
          <canvas id="game" width="1200" height="400"></canvas>
          <div class="bar">
            <div>
              –û—á–∫–∏: <span id="score">0</span> ¬∑ –†–µ–∫–æ—Ä–¥: <span id="best">0</span> ¬∑ –û—Å—Ç–∞–ª–æ—Å—å: <span id="timeLeft">02:00</span>
              <div class="hint">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Space / ‚¨ÜÔ∏é / –¢–∞–ø ¬∑ –î–≤–æ–π–Ω–æ–π –ø—Ä—ã–∂–æ–∫ ‚Äî –≤—Ç–æ—Ä–æ–π —Å–ª–∞–±–µ–µ</div>
            </div>
            <div style="display:flex;gap:8px">
              <button id="restart" class="btn">–ó–∞–Ω–æ–≤–æ</button>
              <button id="newSession" class="btn brand">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
    <div id="regOverlay" class="overlay" style="display:flex">
      <div class="panel">
        <div class="inner">
          <div>
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <div class="field"><label>–§–∞–º–∏–ª–∏—è *</label><input id="lastName" type="text" required autocomplete="family-name"></div>
            <div class="field"><label>–ò–º—è *</label><input id="firstName" type="text" required autocomplete="given-name"></div>
            <div class="field"><label>–û—Ç—á–µ—Å—Ç–≤–æ <span class="note">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label><input id="middleName" type="text" autocomplete="additional-name"></div>
            <div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω *</label><input id="phone" type="tel" placeholder="+7 900 000-00-00" inputmode="tel" autocomplete="tel"></div>
            <div class="field"><label>Email</label><input id="email" type="email" placeholder="name@example.com" autocomplete="email"></div>
            <label class="checkbox"><input id="consent" type="checkbox"> –°–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
            <div class="note">–î–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è –≤—ã–¥–∞—á–∏ –ø—Ä–∏–∑–∞ –∏ —Å–≤—è–∑–∏ —Å –≤–∞–º–∏.</div>
            <div style="margin-top:12px;text-align:right"><button id="startBtn" class="btn brand">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button></div>
            <div id="regErr" class="error"></div>
          </div>

          <div class="qrbox">
            <h3 style="margin:0;color:#000">–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –≥—Ä—É–ø–ø—É –ü—Ä–æ—Ñ–¢—Ä–µ–π–¥–õ–∞–±</h3>
            <img src="assets/qr_group.jpg" alt="QR –≥—Ä—É–ø–ø—ã">
            <small>–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR –∫–∞–º–µ—Ä–æ–π –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ –∫–Ω–æ–ø–∫–µ ‚Äî —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ä–æ–∑—ã–≥—Ä—ã—à–∏ –∏ –Ω–æ–≤–æ—Å—Ç–∏.</small>
            <button id="openGroup" class="btn brand">–û—Ç–∫—Ä—ã—Ç—å –≥—Ä—É–ø–ø—É</button>
          </div>
        </div>
      </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div id="resultOverlay" class="overlay">
      <div class="panel">
        <div class="inner" style="grid-template-columns:1fr">
          <div>
            <h2>–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h2>
            <p>–í–∞—à –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <b id="finalBest">0</b> –æ—á–∫–æ–≤.</p>
            <p>–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: <b id="prizeText">‚Äî</b></p>
            <div style="text-align:right"><button id="toReg" class="btn brand">–ö –Ω–æ–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</button></div>
          </div>
        </div>
      </div>
    </div>

  </div>

<script>
(function(){
  const GROUP_URL='https://t.me/proftradelab';

  try{
    if(window.Telegram&&window.Telegram.WebApp){
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
      Telegram.WebApp.setBackgroundColor("#000000");
      Telegram.WebApp.setHeaderColor("secondary_bg_color");
    }
  }catch(e){}

  const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
  let W=canvas.width,H=canvas.height,GROUND_Y=H-32;

  function resizeCanvas(){
    const rect=canvas.parentElement.getBoundingClientRect();
    const cssW=Math.max(320,Math.floor(rect.width));
    const cssH=Math.max(220,Math.floor(Math.min(rect.height,window.innerHeight)*0.75));
    const dpr=Math.max(1,Math.min(2,window.devicePixelRatio||1));
    canvas.style.width=cssW+'px';canvas.style.height=cssH+'px';
    canvas.width=Math.round(cssW*dpr);canvas.height=Math.round(cssH*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    W=cssW;H=cssH;GROUND_Y=H-32;
  }
  window.addEventListener('resize',resizeCanvas);

  const bgTile=new Image();bgTile.src="assets/background.png";let bgOffset=0;
  function drawBackground(){
    if(!bgTile.complete){ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);return}
    const scale=H/bgTile.height;const tileW=Math.ceil(bgTile.width*scale);const speed=worldSpeed*0.5;
    bgOffset=(bgOffset-speed);if(bgOffset<=-tileW)bgOffset+=tileW;
    for(let x=-tileW;x<W+tileW;x+=tileW){ctx.drawImage(bgTile,x+bgOffset,0,tileW,H)}
  }

  function load(src){const i=new Image();i.src=src;return i}
  const DECOS=[{img:load("assets/deco_clock.png"),w:64,h:64,weight:2},{img:load("assets/deco_panel.png"),w:80,h:80,weight:3},{img:load("assets/deco_console.png"),w:72,h:72,weight:1}];
  const bgDecos=[];const MAX_DECOS_ON_SCREEN=6;let decoTimer=0,decoIntervalMin=1800,decoIntervalVar=2200;
  function pickByWeight(){const t=DECOS.reduce((s,d)=>s+d.weight,0);let r=Math.random()*t;for(let d of DECOS){r-=d.weight;if(r<=0)return d}return DECOS[0]}
  function wallY(){const top=Math.round(H*0.20),bot=Math.round(H*0.45);return Math.floor(top+Math.random()*(bot-top))}
  function schedule(){decoTimer=performance.now()+decoIntervalMin+Math.random()*decoIntervalVar}
  function updateDecoSpawner(now){if(bgDecos.length>=MAX_DECOS_ON_SCREEN)return;if(now>=decoTimer){const t=pickByWeight();const k=0.85+Math.random()*0.4;bgDecos.push({x:W+40,y:wallY(),w:Math.round(t.w*k),h:Math.round(t.h*k),img:t.img});schedule()}}
  function drawDecos(){const v=worldSpeed*0.5;for(let i=bgDecos.length-1;i>=0;i--){const d=bgDecos[i];d.x-=v;if(d.img&&d.img.complete){ctx.imageSmoothingEnabled=false;ctx.drawImage(d.img,d.x,d.y,d.w,d.h)}if(d.x<-d.w-20)bgDecos.splice(i,1)}}

  const sprites={run:[load("assets/player_run1.png"),load("assets/player_run2.png")],jump:load("assets/player_jump.png")};
  let RUN_MS=140,animT=0,animF=0,lastTs=performance.now();
  function drawPlayer(){
    if(!player.onGround){const im=sprites.jump;if(im&&im.complete)ctx.drawImage(im,player.x,player.y,player.w,player.h);return}
    const now=performance.now();const dt=Math.min(100,now-lastTs);lastTs=now;animT+=dt;if(animT>=RUN_MS){animT-=RUN_MS;animF=(animF+1)%2}
    const im=sprites.run[animF];if(im&&im.complete)ctx.drawImage(im,player.x,player.y,player.w,player.h);
  }

  const GRAVITY=0.85,JUMP_VEL1=-12.2,JUMP_VEL2=-9.5,JUMP2_MS=400,JUMP2_MIN_VY=1;
  const TARGET_END_SPEED=11.8,SESSION_LEN_S=120,SPEED_START=5.76,SPEED_ACCEL=(TARGET_END_SPEED-SPEED_START)/SESSION_LEN_S;
  const SPAWN_MIN=340,SPAWN_VAR=300;

  let worldSpeed=SPEED_START,score=0,best=0,gameOver=false,ready=false,runStart=Date.now(),rafId=null;
  const player={x:50,y:0,w:56,h:56,vy:0,onGround:true,jumpCount:0,firstJumpAt:0};

  const SPRITES={HIGH:load("assets/obstacle_high.png"),WIDE:load("assets/obstacle_wide.png"),MEDIUM:load("assets/obstacle_medium.png"),FLY:load("assets/obstacle_fly.png")};
  const obstacles=[];let spawnTimer=0,lastType=-1;
  function chooseType(){let pool=[0,1,2,3];if(lastType!==-1)pool=pool.filter(t=>t!==lastType);const t=pool[Math.floor(Math.random()*pool.length)];lastType=t;return t}
  function spawnObstacle(){const type=chooseType();let w,h,y,sprite;if(type===0){w=50;h=50;sprite=SPRITES.MEDIUM;y=GROUND_Y-h}else if(type===1){w=86;h=50;sprite=SPRITES.WIDE;y=GROUND_Y-h}else if(type===2){w=46;h=94;sprite=SPRITES.HIGH;y=GROUND_Y-h}else{w=58;h=36;sprite=SPRITES.FLY;y=GROUND_Y-90-h;if(y<16)y=16}obstacles.push({x:W+10,y,w,h,sprite,passed:false,type})}

  const OB_W=0.82,OB_H=0.78,PL_W=0.80,PL_H=0.90,OB_HIGH_W=0.75,OB_HIGH_H=0.66;
  function playerHB(p){const w=p.w*PL_W,h=p.h*PL_H;return{x:p.x+(p.w-w)/2,y:p.y+(p.h-h),w,h}}
  function obstacleHB(o){let w,h;if(o.type===2){w=o.w*OB_HIGH_W;h=o.h*OB_HIGH_H}else{w=o.w*OB_W;h=o.h*OB_H}const x=o.x+(o.w-w)/2;const y=o.y+(o.h-h);return{x,y,w,h}}
  function overlap(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y}

  function jump(){
    if(gameOver||!sessionActive()||!ready)return;
    if(player.onGround){player.vy=JUMP_VEL1;player.onGround=false;player.jumpCount=1;player.firstJumpAt=Date.now();return}
    const since=Date.now()-player.firstJumpAt;
    if(player.jumpCount===1&&since<=JUMP2_MS&&player.vy<JUMP2_MIN_VY){player.vy=JUMP_VEL2;player.jumpCount=2}
  }
  window.addEventListener('keydown',e=>{
    if(e.code==='Space'||e.code==='ArrowUp'){e.preventDefault();jump()}
    if(e.code==='Enter'&&(gameOver||!sessionActive())) startCountdown(()=>{resetRun();tickTimer()})
  });
  canvas.addEventListener('pointerdown',jump);

  function loop(){if(rafId)cancelAnimationFrame(rafId);rafId=requestAnimationFrame(update)}
  function update(){
    drawBackground();updateDecoSpawner(performance.now());drawDecos();
    ctx.fillStyle='#53B5AF';ctx.fillRect(0,GROUND_Y,W,2);

    if(!sessionActive()){dimOverlay('–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');return}

    const elapsedSec=(Date.now()-runStart)/1000;worldSpeed=SPEED_START+SPEED_ACCEL*elapsedSec;

    spawnTimer-=worldSpeed;
    if(spawnTimer<=0){spawnObstacle();const bonusGap=(Math.random()<0.18)?160:0;spawnTimer=SPAWN_MIN+Math.random()*SPAWN_VAR+bonusGap}

    player.vy+=GRAVITY;player.y+=player.vy;
    if(player.y>=GROUND_Y-player.h){player.y=GROUND_Y-player.h;player.vy=0;if(!player.onGround){player.onGround=true;player.jumpCount=0}} else {player.onGround=false}

    for(let i=obstacles.length-1;i>=0;i--){
      const o=obstacles[i];o.x-=worldSpeed;
      if(o.sprite&&o.sprite.complete){ctx.imageSmoothingEnabled=false;ctx.drawImage(o.sprite,o.x,o.y,o.w,o.h)}else{ctx.fillStyle='#53B5AF';ctx.fillRect(o.x,o.y,o.w,o.h)}
      if(o.x+o.w<0)obstacles.splice(i,1);
      if(!o.passed&&o.x+o.w<player.x){o.passed=true;score++;updateHud()}
      if(!gameOver&&overlap(playerHB(player),obstacleHB(o))){gameOver=true;if(score>best){best=score;updateHud()}}
    }

    drawPlayer();
    if(!ready){drawCountdown();return}
    if(gameOver)return;
    loop();
  }

  const scoreEl=document.getElementById('score'),bestEl=document.getElementById('best'),timeEl=document.getElementById('timeLeft');
  document.getElementById('restart').onclick=function(){if(!sessionActive())return;startCountdown(()=>{resetRun();tickTimer()})}
  document.getElementById('newSession').onclick=openReg;
  function updateHud(){scoreEl.textContent=String(score);bestEl.textContent=String(best)}

  const regOverlay=document.getElementById('regOverlay'),resultOverlay=document.getElementById('resultOverlay');
  const startBtn=document.getElementById('startBtn'),regErr=document.getElementById('regErr');
  const lastNameIn=document.getElementById('lastName'),firstNameIn=document.getElementById('firstName'),middleNameIn=document.getElementById('middleName'),phoneIn=document.getElementById('phone'),emailIn=document.getElementById('email'),consentIn=document.getElementById('consent');
  const finalBest=document.getElementById('finalBest'),prizeText=document.getElementById('prizeText'),toRegBtn=document.getElementById('toReg'),openGroupBtn=document.getElementById('openGroup');

  let profile=null,sessionEndAt=null,timerId=null;

  function openReg(){regErr.textContent='';regOverlay.style.display='flex'}
  function closeReg(){regOverlay.style.display='none'}
  function normalizePhone(raw){if(!raw)return "";let d=raw.replace(/[^\d]/g,'');if(d.length===11&&d[0]==='8')d='7'+d.slice(1);if(d.length===10)d='7'+d;if(d.length===11&&d[0]==='7')return '+7'+d.slice(1);return ""}
  function isEmailValid(v){if(!v)return true;return/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(v.trim())}

  startBtn.onclick=function(){
    const lastName=lastNameIn.value.trim(),firstName=firstNameIn.value.trim(),middleName=middleNameIn.value.trim(),phoneRaw=phoneIn.value.trim(),email=emailIn.value.trim();
    if(!lastName){regErr.textContent='–£–∫–∞–∂–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é';return}
    if(!firstName){regErr.textContent='–£–∫–∞–∂–∏—Ç–µ –∏–º—è';return}
    const phone=normalizePhone(phoneRaw);if(!phone){regErr.textContent='–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω. –ü—Ä–∏–º–µ—Ä: +7 900 000-00-00';return}
    if(!consentIn.checked){regErr.textContent='–ù—É–∂–Ω–æ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö';return}
    if(!isEmailValid(email)){regErr.textContent='–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π e-mail';return}
    profile={lastName,firstName,middleName,phone,email};
    best=0;score=0;updateHud();
    sessionEndAt=Date.now()+2*60*1000;
    closeReg();
    startCountdown(()=>{resetRun();tickTimer()});
  };

  toRegBtn.onclick=function(){resultOverlay.style.display='none';openReg()};
  openGroupBtn.onclick=function(){try{if(window.Telegram&&window.Telegram.WebApp)Telegram.WebApp.openLink(GROUP_URL,{try_instant_view:false});else window.open(GROUP_URL,'_blank')}catch(e){}};

  function tickTimer(){clearInterval(timerId);timerId=setInterval(function(){const left=Math.max(0,(sessionEndAt||0)-Date.now());timeEl.textContent=fmt(left);if(left<=0){clearInterval(timerId);showResults()}},200)}
  function fmt(ms){const s=Math.ceil(ms/1000),m=Math.floor(s/60),ss=('0'+(s%60)).slice(-2);return('0'+m).slice(-2)+':'+ss}
  function sessionActive(){return sessionEndAt&&Date.now()<sessionEndAt}

  function showResults(){
    finalBest.textContent=String(best);
    prizeText.textContent=getPrize(best);
    try{
      if(window.Telegram&&window.Telegram.WebApp){
        const payload={type:'lead',profile:profile,best:best,ts:Date.now(),endedAt:new Date().toISOString()};
        Telegram.WebApp.sendData(JSON.stringify(payload));
      }
    }catch(e){}
    resultOverlay.style.display='flex';
    setTimeout(()=>{resultOverlay.style.display='none';openReg()},2500);
  }
  function getPrize(p){if(p>=70)return'–¢–µ—Ä–º–æ—Å';if(p>=50)return'–®–æ–ø–ø–µ—Ä';if(p>=30)return'–ë–ª–æ–∫–Ω–æ—Ç –∏ —Ä—É—á–∫–∞';if(p>=20)return'–ë—Ä–µ–ª–æ–∫';return'‚Äî'}

  function startCountdown(cb){ready=false;let t=3;function step(){drawCountdown(t);if(t===0){ready=true;cb&&cb();return}setTimeout(function(){t--;step()},500)}step()}
  function drawCountdown(n){drawBackground();updateDecoSpawner(performance.now());drawDecos();const g=ctx.createLinearGradient(0,GROUND_Y,W,GROUND_Y);g.addColorStop(0,'#53B5AF');g.addColorStop(1,'#53B5AF');ctx.fillStyle=g;ctx.fillRect(0,GROUND_Y,W,2);ctx.fillStyle='rgba(0,0,0,.35)';ctx.fillRect(0,0,W,H);ctx.font='bold 56px monospace';ctx.textAlign='center';ctx.fillStyle='#53B5AF';ctx.fillText((typeof n==='number')?n:' ',W/2,H/2)}
  function dimOverlay(msg){ctx.fillStyle='rgba(0,0,0,.6)';ctx.fillRect(0,0,W,H);ctx.font='16px monospace';ctx.textAlign='center';ctx.fillStyle='#fff';ctx.fillText(msg,W/2,H/2)}
  function resetRun(){runStart=Date.now();worldSpeed=SPEED_START;score=0;gameOver=false;player.y=GROUND_Y-player.h;player.vy=0;player.onGround=true;player.jumpCount=0;animT=0;animF=0;lastTs=performance.now();obstacles.length=0;spawnTimer=0;bgDecos.length=0;bgOffset=0;schedule();if(rafId)cancelAnimationFrame(rafId);rafId=null;loop()}

  resizeCanvas();openReg();
  (function(){ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);const g=ctx.createLinearGradient(0,GROUND_Y,W,GROUND_Y);g.addColorStop(0,'#53B5AF');g.addColorStop(1,'#53B5AF');ctx.fillStyle=g;ctx.fillRect(0,GROUND_Y,W,2)})();
})();
</script>
</body>
</html>
