<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>–ü—Ä–æ—Ñ–¢—Ä–µ–π–¥–õ–∞–± ‚Äî 8bit Runner</title>
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üéÆ</text></svg>'>
  <style>
    :root{ --bg:#000; --card:#111; --accent:#0ff; --ok:#0f0; --bad:#f00; }
    *{ box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: monospace; background: var(--bg); color: #0f0; }
    body { display: grid; place-items: center; }
    .wrap { width: 100%; max-width: 720px; padding: 12px; }
    .card { background: var(--card); border:3px solid #0f0; image-rendering: pixelated; }
    h1 { font-size: 20px; margin: 0 0 8px; color:#0f0; }
    #game { width: 100%; height: auto; background: #111; display: block; image-rendering: pixelated; }
    .bar { font-size:14px; margin:6px 0; display:flex; justify-content:space-between; align-items:center; color:#0f0; }
    .btn { background:#222; color:#0f0; border:2px solid #0f0; font-family:monospace; padding:6px 10px; cursor:pointer; }
    .btn:active { background:#0f0; color:#000; }
    input, label{font-family:monospace;}
    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.9); display:none; align-items:center; justify-content:center; color:#0f0; font-family:monospace; }
    .panel{ background:#111; border:3px solid #0f0; padding:12px; width:90%; max-width:500px; }
    input[type="text"], input[type="email"], input[type="tel"]{ width:100%; background:#000; border:2px solid #0f0; color:#0f0; padding:6px; margin:4px 0; }
    .checkbox{ display:flex; gap:6px; align-items:flex-start; font-size:12px; color:#0f0; }
    table{ width:100%; border-collapse:collapse; color:#0f0; font-size:14px; }
    td,th{ border-bottom:1px solid #0f0; padding:4px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üß™ –ü—Ä–æ—Ñ–¢—Ä–µ–π–¥–õ–∞–± 8-bit Runner</h1>
      <canvas id="game" width="720" height="240"></canvas>
      <div class="bar">
        <span>–û—á–∫–∏:<span id="score">0</span> | –†–µ–∫–æ—Ä–¥:<span id="best">0</span> | –í—Ä–µ–º—è:<span id="timeLeft">05:00</span></span>
        <div>
          <button id="restart" class="btn">–ó–∞–Ω–æ–≤–æ</button>
          <button id="newSession" class="btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
      </div>
    </div>
  </div>

  <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
  <div id="regOverlay" class="overlay" style="display:flex">
    <div class="panel">
      <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <input id="fio" type="text" placeholder="–§–ò–û">
      <input id="phone" type="tel" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
      <input id="email" type="email" placeholder="Email">
      <label class="checkbox"><input id="consent" type="checkbox"> –°–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö</label>
      <div style="margin-top:10px; text-align:right;">
        <button id="startBtn" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
      <div id="regErr" style="color:red;"></div>
    </div>
  </div>

  <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
  <div id="resultOverlay" class="overlay">
    <div class="panel">
      <h2>–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h2>
      <p>–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="finalBest">0</span></p>
      <p>–ü—Ä–∏–∑: <span id="prizeText">‚Äî</span></p>
      <h3>–¢–æ–ø-10</h3>
      <table><tbody id="lbBody"></tbody></table>
      <div style="margin-top:10px;text-align:right;"><button id="resultOk" class="btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button></div>
    </div>
  </div>

<script>
(function(){
  const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
  const W=canvas.width,H=canvas.height,GROUND_Y=H-32,GRAVITY=0.7,JUMP_VELOCITY=-12.5,SPEED_START=6,SPEED_INC=0.0009;
  let worldSpeed=SPEED_START,score=0,best=0,gameOver=false;
  const player={x:50,y:GROUND_Y-20,w:20,h:20,vy:0,onGround:true};
  const obstacles=[]; let spawnTimer=0;
  function resetRun(){worldSpeed=SPEED_START;score=0;gameOver=false;player.y=GROUND_Y-player.h;player.vy=0;player.onGround=true;obstacles.length=0;spawnTimer=0;loop();}
  function spawnObstacle(){const s=10+Math.floor(Math.random()*20);obstacles.push({x:W+10,y:GROUND_Y-s,w:s,h:s,passed:false});}
  function jump(){if(gameOver||!sessionActive())return;if(player.onGround){player.vy=JUMP_VELOCITY;player.onGround=false;}}
  window.addEventListener("keydown",e=>{if(e.code==="Space"||e.code==="ArrowUp"){e.preventDefault();jump();} if(e.code==="Enter"&& (gameOver||!sessionActive()))resetRun();});
  canvas.addEventListener("pointerdown",jump);
  let rafId=null; function loop(){cancelAnimationFrame(rafId);rafId=requestAnimationFrame(update);}
  function update(){
    ctx.fillStyle="#000";ctx.fillRect(0,0,W,H);ctx.fillStyle="#0f0";ctx.fillRect(0,GROUND_Y,W,2);
    if(!sessionActive()){ctx.fillStyle="#0008";ctx.fillRect(0,0,W,H);ctx.fillStyle="#0f0";ctx.fillText("–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞",W/2,H/2);return;}
    spawnTimer-=worldSpeed;if(spawnTimer<=0){spawnObstacle();spawnTimer=100+Math.random()*120;}
    player.vy+=GRAVITY;player.y+=player.vy;if(player.y>=GROUND_Y-player.h){player.y=GROUND_Y-player.h;player.vy=0;player.onGround=true;}
    ctx.fillStyle="#0ff";for(let i=obstacles.length-1;i>=0;i--){const o=obstacles[i];o.x-=worldSpeed;ctx.fillRect(o.x,o.y,o.w,o.h);if(o.x+o.w<0)obstacles.splice(i,1);if(!o.passed&&o.x+o.w<player.x){o.passed=true;score++;updateHud();}if(!gameOver&&aabb(player,o)){gameOver=true;if(score>best){best=score;updateHud();}}}
    ctx.fillStyle=gameOver?"#f00":"#0f0";ctx.fillRect(player.x,player.y,player.w,player.h);
    if(gameOver)return;worldSpeed+=SPEED_INC;loop();
  }
  function aabb(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;}
  const scoreEl=document.getElementById("score"),bestEl=document.getElementById("best"),timeEl=document.getElementById("timeLeft");
  document.getElementById("restart").onclick=()=>{if(sessionActive()){resetRun();gameOver=false;}};
  document.getElementById("newSession").onclick=openReg;
  function updateHud(){scoreEl.textContent=score;bestEl.textContent=best;}
  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —Å–µ—Å—Å–∏—è
  const regOverlay=document.getElementById("regOverlay"),resultOverlay=document.getElementById("resultOverlay");
  const startBtn=document.getElementById("startBtn"),resultOk=document.getElementById("resultOk"),regErr=document.getElementById("regErr");
  const fioIn=document.getElementById("fio"),phoneIn=document.getElementById("phone"),emailIn=document.getElementById("email"),consentIn=document.getElementById("consent");
  const finalBest=document.getElementById("finalBest"),lbBody=document.getElementById("lbBody"),prizeText=document.getElementById("prizeText");
  let profile=null,sessionEndAt=null;
  function openReg(){regOverlay.style.display="flex";} function closeReg(){regOverlay.style.display="none";}
  startBtn.onclick=()=>{const fio=fioIn.value.trim(),phone=phoneIn.value.trim(),email=emailIn.value.trim();if(!fio){regErr.textContent="–£–∫–∞–∂–∏—Ç–µ –§–ò–û";return;}if(!consentIn.checked){regErr.textContent="–ù—É–∂–Ω–æ —Å–æ–≥–ª–∞—Å–∏–µ";return;}profile={fio,phone,email};best=0;score=0;updateHud();sessionEndAt=Date.now()+5*60*1000;closeReg();resetRun();tickTimer();};
  resultOk.onclick=()=>{resultOverlay.style.display="none";openReg();};
  let timerId=null;function tickTimer(){clearInterval(timerId);timerId=setInterval(()=>{const left=Math.max(0,(sessionEndAt||0)-Date.now());timeEl.textContent=fmt(left);if(left<=0){clearInterval(timerId);showResults();}},200);}
  function fmt(ms){const s=Math.ceil(ms/1000),m=Math.floor(s/60),ss=String(s%60).padStart(2,"0");return `${String(m).padStart(2,"0")}:${ss}`;}
  function sessionActive(){return sessionEndAt&&Date.now()<sessionEndAt;}
  function showResults(){if(profile){saveLB(profile.fio,best);}finalBest.textContent=best;prizeText.textContent=getPrize(best);renderLB();resultOverlay.style.display="flex";}
  function getPrize(p){if(p>=3000)return"–¢–µ—Ä–º–æ—Å";if(p>=2000)return"–®–æ–ø–ø–µ—Ä";if(p>=1000)return"–ë–ª–æ–∫–Ω–æ—Ç –∏ —Ä—É—á–∫–∞";if(p>=500)return"–ë—Ä–µ–ª–æ–∫";return"‚Äî";}
  function saveLB(fio,points){const arr=JSON.parse(localStorage.getItem("lb")||"[]");arr.push({fio,points,ts:new Date().toISOString()});arr.sort((a,b)=>b.points-a.points);localStorage.setItem("lb",JSON.stringify(arr.slice(0,10)));}
  function renderLB(){const arr=JSON.parse(localStorage.getItem("lb")||"[]");lbBody.innerHTML="";arr.forEach((r,i)=>{const d=new Date(r.ts).toLocaleString();lbBody.innerHTML+=`<tr><td>${i+1}</td><td>${r.fio}</td><td>${r.points}</td><td>${d}</td></tr>`;});}
  openReg();updateHud();
})();
</script>
</body>
</html>

