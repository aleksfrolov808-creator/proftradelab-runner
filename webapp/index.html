<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<title>–ü—Ä–æ—Ñ–¢—Ä–µ–π–¥–õ–∞–± ‚Äî 8-bit Runner</title>
<style>
:root{--brand:#53B5AF;--bg:#000000;--text:#ffffff;--pad:12px;--app-height:100vh}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:monospace;background:var(--bg);color:var(--text)}
#app-root{position:relative;width:100%;min-height:var(--app-height);display:flex}
.wrap{flex:1;display:flex}
.card{flex:1;display:flex;flex-direction:column;background:var(--bg);border:3px solid var(--brand)}
h1{font-size:20px;margin:0;padding:10px var(--pad);color:var(--text)}
canvas{display:block;width:100%;height:100%;background:#000;image-rendering:pixelated}
.bar{display:flex;justify-content:space-between;align-items:flex-start;gap:8px;padding:8px var(--pad);flex-wrap:wrap}
.btn{background:var(--brand);color:#000;border:none;padding:8px 12px;cursor:pointer;border-radius:6px}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:999}
.panel{background:#fff;color:#000;border-radius:10px;width:100%;max-width:600px;padding:20px}
.field{margin:8px 0}
input{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px}
.checkbox{display:flex;gap:8px;align-items:flex-start;font-size:12px}
.prizes{margin-top:12px;border:1px solid #ccc;border-radius:8px;padding:10px;background:#fafafa}
.prizes h3{margin:0 0 8px 0}
.prize-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #ccc}
.prize-row:last-child{border-bottom:none}
</style>
</head>
<body>
<div id="app-root">
<div class="wrap">
<div class="card">
<h1>üß™ –ü—Ä–æ—Ñ–¢—Ä–µ–π–¥–õ–∞–± 8-bit Runner</h1>
<canvas id="game" width="1200" height="400"></canvas>
<div class="bar">
<div>–û—á–∫–∏: <span id="score">0</span> ¬∑ –†–µ–∫–æ—Ä–¥: <span id="best">0</span> ¬∑ –û—Å—Ç–∞–ª–æ—Å—å: <span id="timeLeft">02:00</span></div>
<div style="display:flex;gap:8px"><button id="restart" class="btn">–ó–∞–Ω–æ–≤–æ</button><button id="newSession" class="btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button></div>
</div>
</div>
</div>
<div id="regOverlay" class="overlay" style="display:flex">
<div class="panel">
<h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
<div class="field"><label>–§–∞–º–∏–ª–∏—è *</label><input id="lastName" type="text"></div>
<div class="field"><label>–ò–º—è *</label><input id="firstName" type="text"></div>
<div class="field"><label>–û—Ç—á–µ—Å—Ç–≤–æ</label><input id="middleName" type="text"></div>
<div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω *</label><input id="phone" type="tel"></div>
<div class="field"><label>Email</label><input id="email" type="email"></div>
<label class="checkbox"><input id="consent" type="checkbox"> –°–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
<div id="regErr" style="color:red;margin-top:6px"></div>
<div style="margin-top:12px;text-align:right"><button id="startBtn" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button></div>
<div class="prizes">
<h3>–ü—Ä–∏–∑—ã –∏ –æ—á–∫–∏</h3>
<div class="prize-row"><div>20‚Äì30</div><div>–ë—Ä–µ–ª–æ–∫</div></div>
<div class="prize-row"><div>30‚Äì50</div><div>–ë–ª–æ–∫–Ω–æ—Ç –∏ —Ä—É—á–∫–∞</div></div>
<div class="prize-row"><div>50‚Äì70</div><div>–®–æ–ø–ø–µ—Ä</div></div>
<div class="prize-row"><div>70+</div><div>–¢–µ—Ä–º–æ—Å</div></div>
</div>
</div>
</div>
<div id="resultOverlay" class="overlay">
<div class="panel">
<h2>–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h2>
<p>–í–∞—à –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <b id="finalBest">0</b> –æ—á–∫–æ–≤.</p>
<p>–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: <b id="prizeText">‚Äî</b></p>
<p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∑–∞ –ø—Ä–∏–∑–æ–º.</p>
<button id="resultOk" class="btn">–ù–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
</div>
</div>
</div>
<script>
(function(){
const canvas=document.getElementById('game');const ctx=canvas.getContext('2d');let W=canvas.width,H=canvas.height,GROUND_Y=H-32
function resizeCanvas(){const r=canvas.parentElement.getBoundingClientRect();const cw=Math.floor(r.width);const ch=Math.floor(r.height);canvas.width=cw;canvas.height=ch;W=cw;H=ch;GROUND_Y=H-32}
window.addEventListener('resize',resizeCanvas);resizeCanvas()
const GRAVITY=0.8,JUMP_VEL=-12,JUMP_VEL2=-9,SPEED_START=4.5,SPEED_ACCEL=0.035
let worldSpeed=SPEED_START,score=0,best=0,gameOver=false,ready=false,runStart=Date.now()
const player={x:50,y:GROUND_Y-56,w:56,h:56,vy:0,onGround:true,jumpCount:0,maxJumps:2,firstJumpAt:0}
const imgRun1=new Image();imgRun1.src='assets/run_1.png';const imgRun2=new Image();imgRun2.src='assets/run_2.png';const imgJump=new Image();imgJump.src='assets/jump.png'
const SPRITES={HIGH:new Image(),WIDE:new Image(),MEDIUM:new Image(),FLY:new Image()}
SPRITES.HIGH.src='assets/obs_1.png';SPRITES.WIDE.src='assets/obs_2.png';SPRITES.MEDIUM.src='assets/obs_3.png';SPRITES.FLY.src='assets/fly_obs.png'
const bgTile=new Image();bgTile.src='assets/background.png'
let bgOffset=0,playerFrame=0,playerFrameTime=0
let obstacles=[]
function drawBackground(){if(!bgTile.complete)return;const scale=H/bgTile.height;const tw=Math.ceil(bgTile.width*scale);bgOffset=(bgOffset-worldSpeed*0.5)%tw;for(let x=-tw;x<W+tw;x+=tw)ctx.drawImage(bgTile,x+bgOffset,0,tw,H)}
function jump(){if(gameOver||!ready)return;if(player.onGround){player.vy=JUMP_VEL;player.onGround=false;player.jumpCount=1;player.firstJumpAt=Date.now();return}const since=Date.now()-player.firstJumpAt;if(player.jumpCount===1&&since<=400&&player.vy<1){player.vy=JUMP_VEL2;player.jumpCount=2}}
window.addEventListener('keydown',e=>{if(e.code==='Space'||e.code==='ArrowUp'){e.preventDefault();jump()}})
canvas.addEventListener('pointerdown',jump)
function spawnObstacle(){const type=Math.floor(Math.random()*4);let w,h,y,sprite;if(type===0){w=64;h=64;sprite=SPRITES.MEDIUM;y=GROUND_Y-h}else if(type===1){w=120;h=64;sprite=SPRITES.WIDE;y=GROUND_Y-h}else if(type===2){w=64;h=100;sprite=SPRITES.HIGH;y=GROUND_Y-h}else{w=48;h=48;sprite=SPRITES.FLY;y=GROUND_Y-90-h;if(y<16)y=16}obstacles.push({x:W+10,y,w,h,sprite,passed:false})}
function collide(a,b){const f=4;return a.x<b.x+b.w-f&&a.x+a.w>b.x+f&&a.y<b.y+b.h-f&&a.y+a.h>b.y+f}
function drawPlayer(){const img=player.onGround?(playerFrame?imgRun2:imgRun1):imgJump;if(img.complete)ctx.drawImage(img,player.x,player.y,player.w,player.h)}
let spawnTimer=0,SPAWN_MIN=350,SPAWN_VAR=300
function update(){ctx.clearRect(0,0,W,H);drawBackground();ctx.fillStyle='#53B5AF';ctx.fillRect(0,GROUND_Y,W,2)
if(!ready){drawCountdown(3);return}
player.vy+=GRAVITY;player.y+=player.vy
if(player.y>=GROUND_Y-player.h){player.y=GROUND_Y-player.h;player.vy=0;player.onGround=true;player.jumpCount=0}
else player.onGround=false
const elapsed=(Date.now()-runStart)/1000;worldSpeed=SPEED_START+SPEED_ACCEL*elapsed
spawnTimer-=worldSpeed;if(spawnTimer<=0){spawnObstacle();spawnTimer=SPAWN_MIN+Math.random()*SPAWN_VAR}
for(let i=obstacles.length-1;i>=0;i--){const o=obstacles[i];o.x-=worldSpeed;if(o.sprite.complete)ctx.drawImage(o.sprite,o.x,o.y,o.w,o.h);if(o.x+o.w<0)obstacles.splice(i,1);if(!o.passed&&o.x+o.w<player.x){o.passed=true;score++;updateHud()}if(!gameOver&&collide(player,o)){gameOver=true;if(score>best)best=score;updateHud()}}
playerFrameTime+=worldSpeed;if(playerFrameTime>20){playerFrameTime=0;playerFrame=!playerFrame}drawPlayer()
if(!gameOver)requestAnimationFrame(update)
}
function drawCountdown(n){ctx.fillStyle='rgba(0,0,0,.4)';ctx.fillRect(0,0,W,H);ctx.font='bold 56px monospace';ctx.textAlign='center';ctx.fillStyle='#53B5AF';ctx.fillText(n,W/2,H/2)}
const scoreEl=document.getElementById('score');const bestEl=document.getElementById('best');const timeEl=document.getElementById('timeLeft')
function updateHud(){scoreEl.textContent=score;bestEl.textContent=best}
let timerId=null,sessionEndAt=null
function tickTimer(){clearInterval(timerId);timerId=setInterval(()=>{const left=Math.max(0,(sessionEndAt||0)-Date.now());timeEl.textContent=fmt(left);if(left<=0){clearInterval(timerId);showResults()}},200)}
function fmt(ms){const s=Math.ceil(ms/1000),m=Math.floor(s/60),ss=String(s%60).padStart(2,'0');return`${String(m).padStart(2,'0')}:${ss}`}
function getPrize(p){if(p>=70)return'–¢–µ—Ä–º–æ—Å';if(p>=50)return'–®–æ–ø–ø–µ—Ä';if(p>=30)return'–ë–ª–æ–∫–Ω–æ—Ç –∏ —Ä—É—á–∫–∞';if(p>=20)return'–ë—Ä–µ–ª–æ–∫';return'‚Äî'}
function showResults(){document.getElementById('finalBest').textContent=best;document.getElementById('prizeText').textContent=getPrize(best);try{if(window.Telegram?.WebApp){window.Telegram.WebApp.sendData(JSON.stringify({type:'lead',profile,best,endedAt:new Date().toISOString()}))}}catch(e){}document.getElementById('resultOverlay').style.display='flex'}
const regOverlay=document.getElementById('regOverlay');const resultOverlay=document.getElementById('resultOverlay');const startBtn=document.getElementById('startBtn');const resultOk=document.getElementById('resultOk');const regErr=document.getElementById('regErr')
let profile=null
startBtn.onclick=()=>{const last=document.getElementById('lastName').value.trim(),first=document.getElementById('firstName').value.trim(),middle=document.getElementById('middleName').value.trim(),phone=document.getElementById('phone').value.trim(),email=document.getElementById('email').value.trim(),consent=document.getElementById('consent').checked;if(!last||!first){regErr.textContent='–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é';return}if(!consent){regErr.textContent='–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ';return}profile={lastName:last,firstName:first,middleName:middle,phone,email};score=0;best=0;updateHud();sessionEndAt=Date.now()+2*60*1000;tickTimer();regOverlay.style.display='none';ready=true;runStart=Date.now();gameOver=false;obstacles=[];update()}
resultOk.onclick=()=>{resultOverlay.style.display='none';regOverlay.style.display='flex'}
})();
</script>
</body>
</html>
